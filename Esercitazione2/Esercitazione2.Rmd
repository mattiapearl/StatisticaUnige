---
title: "Esercitazione 2 ðŸ“ˆ"
author: "Bastreghi Ranalli Torriglia"
date: '2022-03-24'
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r echo=FALSE, warning = FALSE}
# Setup preliminare
setwd("C:/Files/Personali/Unige/Code/SD/StatGit/Esercitazione2")
dati = read.table(
  "amici.txt",
  # No separatori, no na fields
  header = T,
  )
library(RColorBrewer)
library(grid)
library(gridExtra)
```

# Esercizio 1

## Introduzione
### Frequenza degli incontri con gli amici e fascia di etÃ 
Vengono anlaizzate delle rilevazioni fatte durante un indagine **ISTAT** del 2010: "Aspetti della vita quotidiana". In particolare in questo paragrafo *(esercizio 1)* si studia il rapporto tra frequenza degli incontri con gli amici e la fascia di etÃ 
```{r echo=FALSE, warning = FALSE}
datiMatr <- data.matrix(dati[,-1])
rownames(datiMatr) = dati[,1]

#Costruisco le tabelle rel congiunte, marginali, e poi i profili riga
freqRelCongiunta = prop.table(datiMatr)

freqMarginali = addmargins(freqRelCongiunta)
freqMarginaliRiga = freqMarginali[-13,7]
freqMarginaliColonna = freqMarginali[13,-7]

freqCondizionateRiga = prop.table(datiMatr,1)
freqCondizionateColonna = prop.table(datiMatr,2)

### Creo i baplot



coul <- brewer.pal(12, "Set2")


#Freq rel congiunte
barplot(freqRelCongiunta, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze relativa congiunta ", col = coul, xlab = "QuantitÃ  incontri con amici", ylab = "Frequenza", legend.text =dati[,1],args.legend = list(x = "topright", cex = 0.65))
# Uso libreria esterna: creo nuova finestra per griglia
grid.newpage()
grid.table(datiMatr);


par(mfrow = c(1, 1))

#Freq marginali colonne
barplot(freqMarginaliColonna, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze marginali colonne", col = coul, xlab = "QuantitÃ  incontri con amici", ylab = "Frequenza")

par(mfrow = c(1, 1))
#Freq marginali righe
barplot(freqMarginaliRiga, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze marginali righe", col = coul, xlab = "Gruppo di etÃ ", ylab = "Frequenza")
grid.newpage()
grid.table(round(freqMarginali,4)*100)
```

## Commento sulle frequenze relative congiunte e sulle frequenze marginali 
Partendo da un analisi di forma, si puÃ² subito intuire che le prime colonne, ovvero quelle relative a **tutti i giorni**, **piÃ¹ volte a settimana**, **una volta a settimana** e **qualche volta al mese** hanno una frequenza marginale^1 che cumulata supera l'*80%*.  
Restringendo leggermente i "margini di osservazione", si puÃ² notare come giÃ  le prime due colonne costituiscano circa il *50%* delle osservazioni, suggerendo che nella popolazione analizzata questa sia l'opzione piÃ¹ comune.
Prima di consultare i profili marginali riga (relativi alle fasce d'etÃ ), si puÃ² giÃ  notare come la popolazione tra **25 e i 54 anni** sia quella con piÃ¹ osservazioni.  
CiÃ² implica che in casi come la quantitÃ  di incontri giornalieri con amici, in cui si nota una preponderanza della classe **6-14 anni**, poi evidenziata nei profili colonna, non si noti la massima frequenza marginale colonna poichÃ¨ la classe piÃ¹ frequente sopra citata non ne prende attivamente parte (*come fa in tutti i casi da piÃ¹ volte a settimana fino a qualche volta al mese*).

Sembra che la classe piÃ¹ comune di etÃ , tenda ad avere dei dati alquanto ben distribuiti nelle prime 4 categorie osservate di quantitÃ  di uscite/incontri con amici, il che puÃ² suggerire che altre osservazioni potrebbero essere necessarie per le classi con meno rilevazioni.

> ^1 costituita dalla somma delle frequenze relative congiunte, quindi dall'altezza della colonna. Si osserva questa congruenza nel barplot della frequenza marginale colonna 





```{r echo=FALSE, warning = FALSE}
#Profili riga e colonna
prof_rg = prop.table(datiMatr, 1)
prof_col = prop.table(datiMatr, 2)

par(mfrow = c(1,2))

barplot(t(prof_rg), cex.names = 0.6,cex.axis = 0.6, main = "Profili riga", col = coul, ylab = "Frequenza", legend.text = colnames(datiMatr),args.legend = list(x = "bottomleft", cex = 0.65), las = 2 )
barplot(prof_col, cex.names = 0.6,cex.axis = 0.6, main = "Profili colonna", col = coul, ylab = "Frequenza",legend.text = rownames(datiMatr),args.legend = list(x = "topright",inset = c(-0.17,0), cex = 0.65), las = 2)

# Itero attraverso le righe e creo un barplot per ogni deviazione 
par(mfrow = c(3,4), oma = c(0,0,3,0))



for (i in 1:dim(datiMatr)[1]){

  dev_riga = prof_rg[i,] - freqMarginaliColonna
  barplot(dev_riga, cex.names = 0.6,cex.axis = 0.6,main = rownames(datiMatr)[i], col = coul, las = 2,ylim = c(-0.2,0.5))
abline(h=0)
  }
mtext("Deviazione dei profili riga dal marginale colonna", outer=TRUE,cex =1, side = 3)

# Itero attraverso le colonne e creo un barplot per ogni deviazione 
par(mfrow = c(3,2), oma = c(0,0,3,0))
for (i in 1:dim(datiMatr)[2]){
  dev_colonna = prof_col[,i] - freqMarginaliRiga
  barplot(dev_colonna, cex.names = 0.6,cex.axis = 0.6,main =  colnames(datiMatr)[i], col = coul, las = 2,ylim = c(-0.1,0.3))
abline(h=0)
    }
mtext("Deviazione dei profili colonna dal marginale riga", outer=TRUE,cex =1, side = 3)

```

# Esercizio 2
## Introduzione
### Luogo consumazione pasto e titolo di studio
Si studiano i dati relativi ad un indagine ISTAT che correla il luogo di consumazione del pasto e il titolo di studio.

```{r echo=FALSE, warning = FALSE}
datiMatr = matrix(c(2829, 433, 394, 431,401, 9201,1092,733,691,1256,14764,877,531,337,1652,14759,1119,71,42,319 ), nrow = 4, ncol = 5, byrow = TRUE, )
colnames(datiMatr) <-  c("Casa", "Mensa", "Rist.", "Bar", "Posto lav.")
rownames(datiMatr) <-  c("Laurea","Diploma sup","Media", "Elementare")

#Costruisco le tabelle rel congiunte, marginali, e poi i profili riga
freqRelCongiunta = prop.table(datiMatr)

freqMarginali = addmargins(freqRelCongiunta)
freqMarginaliRiga = freqMarginali[-5,6]
freqMarginaliColonna = freqMarginali[5,-6]

freqCondizionateRiga = prop.table(datiMatr,1)
freqCondizionateColonna = prop.table(datiMatr,2)

### Creo i baplot
coul <- brewer.pal(6, "Set2")

#Freq rel congiunte
barplot(freqRelCongiunta, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze relative congiunta ",beside = T, col = coul, xlab = "", ylab = "Frequenza", legend.text =dati[,1],args.legend = list(x = "topright", cex = 0.65))
grid.newpage()
grid.table(datiMatr);

#Freq marginali colonne
barplot(freqMarginaliColonna, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze marginali colonne", col = coul, xlab = "QuantitÃ  inctotri con amici", ylab = "Frequenza")

#Freq marginali righe
barplot(freqMarginaliRiga, cex.names = 0.6,cex.axis = 0.6, main = "Frequenze marginali righe", col = coul, xlab = "Gruppo di etÃ ", ylab = "Frequenza")
grid.newpage()
grid.table(round(freqMarginali,4)*100)
```

## Studio delle frequenze relative congiunte e frequenze marginali
Prima di studiare i dati Ã¨ obbligatorio notare come le rilevazioni di persone che mangiano a **casa** siano l'80 percento del totale. Quindi come sicuramente renderanno poco efficace l'osservazione non correlata alle deviazioni dei profili riga e colonna, come avveniva nello studio precedente con la classe di etÃ  tra i 25 e i 54 anni.  
Analogamente si puÃ² osservare come tra le rilevazioni meno del 10% abbia una laurea come titolo di studio. Quando si studieranno i relativi profili colonna sarÃ  quindi necessario rapportare la dimensione del dato ottenuto con la frequenza totale dei laureati, cosa che verrÃ  evidenziata con lo studio delle deviazioni.  

```{r echo=FALSE, warning = FALSE}
#Profili riga e colonna
prof_rg = prop.table(datiMatr, 1)
prof_col = prop.table(datiMatr, 2)

par(mfrow = c(1,2))

barplot(t(prof_rg), cex.names = 0.6,cex.axis = 0.6, main = "Profili riga", col = coul, ylab = "Frequenza", legend.text = colnames(datiMatr),args.legend = list(x = "bottomleft", cex = 0.65), las = 2 )
barplot(prof_col, cex.names = 0.6,cex.axis = 0.6, main = "Profili colonna", col = coul, ylab = "Frequenza",legend.text = rownames(datiMatr),args.legend = list(x = "topleft",inset = c(-0.17,0), cex = 0.65), las = 2)
```
  
## Commento alle distribuzioni marginali condizionate   

### Profili riga  

Dai grafici si riesce a capire che le osservazioni **non sono indipendenti**.                                

La tabella dei profili riga evidenzia il luogo in cui gli italiani consumano il pranzo, in base al loro titolo di studio a prescindere dalla numerositÃ  della classe relativa.

Dai profili riga (come dalla distribuzione marginale) si osserva che la maggior parte degli italiani consuma il pranzo a casa. Sempre secondo i dati, coloro che hanno un titolo di studio elementare tendono a non pranzare al bar o al ristorante, a differenza di coloro che hanno una laurea o un diploma superiore. *Non essendo evidenziata lâ€™etÃ  dei partecipanti allo studio, ciÃ² potrebbe essere influenzato dallâ€™indipendenza degli individui osservati.*

La fascia di coloro che mangiano al bar Ã¨ la piÃ¹ piccola sia per le unitÃ  sperimentali che hanno una licenza media che per quelle che hanno una licenza elementare.

Si puÃ² anche osservare che la distribuzione di coloro che mangiano sul posto di lavoro Ã¨ molto simile tra gli italiani che hanno una laurea, un diploma superiore o una licenza media, invece varia per coloro che hanno una licenza elementare.

La frequenza marginali di coloro che hanno la licenza media Ã¨ la piÃ¹ alta. Come verrÃ  evidenziato nel commento relativo alle deviazioni dai profili riga, ciÃ² inficia sulla capacitÃ  di analisi dei dati a partire dai profili colonna. Infatti un maggior numero assoluto di rilevazioni porta alla predominanza del valore nel profilo colonna, che potrebbe erroneamente suggerire una preferenza di tale scelta da parte del gruppo sopracitato nei vari casi. CiÃ² viene confutato osservando le deviazioni.

### Profili colonna
La tabella dei profili colonna condiziona rispetto al titolo di studio il luogo in cui  viene consumato il pranzo, *prescindendo dalla numerositÃ  della classe.*

Si osserva che tra gli italiani che pranzano nel loro posto di lavoro la maggior parte sono quelli che hanno una licenza media, subito seguiti da coloro che hanno un diploma superiore; tra coloro che mangiano a casa la maggior parte ha un titolo di studio elementare, invece una minima parte Ã¨ rappresentata da coloro che hanno una laurea. Si nota inoltre che i dati relativi a coloro che mangiano a casa e coloro che mangiano in mensa sono relativamente simili, come anche per quanto riguarda coloro che pranzano al ristorante e coloro che pranzano al bar.

Infine, si puÃ² notare che le rilevazioni riguardanti mensa e posto di lavoro, sono relativamente simili per coloro che hanno la laurea e gli italiani che hanno un diploma superiore, invece variano per coloro che hanno una licenza media o elementare.

```{r echo=FALSE, warning = FALSE}
# Itero attraverso le righe e creo un barplot per ogni deviazione 
par(mfrow = c(2,2), oma = c(0,0,5,0))

for (i in 1:dim(datiMatr)[1]){

  dev_riga = prof_rg[i,] - freqMarginaliColonna
  barplot(dev_riga, cex.names = 0.6,cex.axis = 0.6,main = rownames(datiMatr)[i],ylim = c(-0.2,0.3), col = coul, las = 2)
abline(h=0)
  }
mtext("Deviazione dei profili riga dal marginale colonna", outer=TRUE,cex =1, side = 3)


# Itero attraverso le colonne e creo un barplot per ogni deviazione 
par(mfrow = c(2,3), oma = c(0,0,5,0))
for (i in 1:dim(datiMatr)[2]){

  dev_colonna = prof_col[,i] - freqMarginaliRiga
  barplot(dev_colonna, cex.names = 0.6,cex.axis = 0.6,main =  colnames(datiMatr)[i], col = coul, las = 2,ylim = c(-0.5,0.4))
abline(h=0)  
}
mtext("Deviazione dei profili colonna dal marginale riga", outer=TRUE,cex =1, side = 3)
```

## Analisi deviazione distribuzioni condizionate
***Tutte le osservazioni seguenti sono fatte in relazione ai profili marginali.***

Dalla tabella della deviazione dei profili riga dal marginale si nota ancora di piÃ¹ come coloro che hanno una laurea tendono a mangiare principalmente al bar o al ristorante e raramente a casa. Opposti sono i risultati per le unitÃ  sperimentali che hanno una licenza elementare che tendono a pranzare principalmente a casa.

Per quanto riguarda gli italiani che possiedono un diploma superiore, sono ben distribuiti tra mensa, ristorante, bar e posto di lavoro, mentre tendono a non mangiare a casa.

La popolazione che ha una licenza media Ã¨ quella una maggiore popolositÃ , quindi questo va ad influenzare la frequenza marginale riga. Come preannunciato, si vede che la deviazione del profilo riga dal profilo medio Ã¨ in valore assoluto la minore.

*Quindi si puÃ² azzardare che le deviazioni dellâ€™intero dataset rispetto ai marginali colonna siano deviazioni da ciÃ² che fa la popolazione con la licenza media, o che questa Ã¨ uno specchio della media della popolazione.*


Dalla tabella della deviazione dei profili colonna dal marginale riga si vede come il maggior numero di persone che pranzano al bar oppure al ristorante sono coloro che hanno una laurea oppure un diploma superiore; invece, coloro che hanno una licenza elementare tendono a non mangiare al bar, al ristorante, o sul posto di lavoro. Per quanto riguarda coloro che pranzano in mensa la maggior parte sembrano essere le persone che hanno un diploma superiore invece coloro che hanno una licenza media tendono ad evitare la mensa. Come per la licenza media, ma in proporzione maggiore, gli stessi fenomeni avvengono nel rapporto tra marginali riga e profili colonna.

# Grazie per l'attenzione 